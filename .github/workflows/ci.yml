name: CI ThingsBoard

on:
  push:
    branches: ["**"]

jobs:
  tests-common:
    name: Tests common/data et common/util
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'
          cache: 'maven'

      - name: Run ONLY common tests
        run: mvn test -pl common/data,common/util,edqs,rule-engine/rule-engine-api,rule-engine/rule-engine-components -am \
              -Dlicense.skip=true \
              -Dcheckstyle.skip=true \
              -Dformatter.skip=true \
              -Dimpsort.skip=true

#  docker-run:
#    name: Build & Run ThingsBoard (from THIS repo)
#    needs: tests-common
#    runs-on: ubuntu-latest
#
#    steps:
#      - uses: actions/checkout@v4
#
#      - name: Set up JDK 17
#        uses: actions/setup-java@v4
#        with:
#          java-version: '17'
#          distribution: 'temurin'
#          cache: 'maven'
#
#      - name: Build ThingsBoard (no tests)
#        run: |
#          mvn clean install -DskipTests \
#            -Dlicense.skip=true \
#            -Dcheckstyle.skip=true \
#            -Dformatter.skip=true \
#            -Dimpsort.skip=true
#
#      - name: Build Docker image from this repo
#        run: |
#          # Build ton image ThingsBoard Ã  partir du code
#          docker build -t tb-local -f docker/Dockerfile .
#
#      - name: Start ThingsBoard with Docker Compose (Postgres)
#        run: |
#          cd docker
#          # Lancer Docker Compose en utilisant ton image locale via override
#          docker compose -f docker-compose.postgres.yml -f docker-compose.override.ci.yml run --rm -e INSTALL_TB=true -e LOAD_DEMO=true thingsboard-ce
#          docker compose -f docker-compose.postgres.yml -f docker-compose.override.ci.yml up -d
#
#      - name: Check running container
#        run: |
#          docker ps
#          cd docker
#          docker compose -f docker-compose.postgres.yml -f docker-compose.override.ci.yml down